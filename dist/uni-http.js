!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.uniHttp=t():e.uniHttp=t()}(this,(function(){return(()=>{var e={422:function(e){e.exports=(()=>{"use strict";var e={d:(t,r)=>{for(var s in r)e.o(r,s)&&!e.o(t,s)&&Object.defineProperty(t,s,{enumerable:!0,get:r[s]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t),r:e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}},t={};e.r(t),e.d(t,{Completer:()=>r});class r extends class{isCompleted=!1}{_res;_rej;promise;constructor(){super(),this.promise=new Promise(((e,t)=>{this._res=e,this._rej=t}))}complete(e){if(this.isCompleted)throw Error("Promise already completed");this._res(e),this.isCompleted=!0}completeError(e){if(this.isCompleted)throw Error("Promise already completed");this._rej(e),this.isCompleted=!0}}return t})()}},t={};function r(s){var o=t[s];if(void 0!==o)return o.exports;var a=t[s]={exports:{}};return e[s].call(a.exports,a,a.exports,r),a.exports}r.d=(e,t)=>{for(var s in t)r.o(t,s)&&!r.o(e,s)&&Object.defineProperty(e,s,{enumerable:!0,get:t[s]})},r.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),r.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};var s={};return(()=>{"use strict";r.r(s),r.d(s,{UniAbortController:()=>t,UniHttp:()=>f,UniHttpInterceptors:()=>d,jsonToSerialize:()=>n,mergeConfig:()=>o,mergeUrl:()=>a,parseUrlParams:()=>l,removeHeaderContentType:()=>i,urlWithParams:()=>c});var e=r(422);class t{completer;constructor(){this.completer=new e.Completer}abort(){this.completer.complete(!0)}}function o(e,t){const r={baseURL:e.baseURL??t.baseURL,url:e.url??t.url,method:e.method??t.method??"GET",data:Object.assign({},t.data,e.data),params:Object.assign({},t.params,e.params),header:Object.assign({},t.header,e.header),filePath:e.filePath??t.filePath,name:e.name??t.name,timeout:e.timeout??t.timeout,dataType:e.dataType??t.dataType,responseType:e.responseType??t.responseType,sslVerify:e.sslVerify??t.sslVerify,withCredentials:e.withCredentials??t.withCredentials,firstIpv4:e.firstIpv4??t.firstIpv4,success:e.success??t.success,fail:e.fail??t.fail,complete:e.complete??t.complete,fileType:e.fileType??t.fileType,file:e.file??t.file,files:e.files??[],abortController:e.abortController??t.abortController,offHeadersReceived:e.offHeadersReceived??t.offHeadersReceived,onHeadersReceived:e.onHeadersReceived??t.onHeadersReceived,onProgressUpdate:e.onProgressUpdate??t.onProgressUpdate,offProgressUpdate:e.offProgressUpdate??t.offProgressUpdate,interceptors:e.interceptors??[]};return t.files&&(r.files=r.files?.concat(t.files)),t.interceptors&&(r.interceptors=r.interceptors?.concat(t.interceptors)),r}function a(e,t=""){const r=t.match(/^https?:\/\//);return r||t.startsWith("/")||(t="/"+t),e?r?t:e.replace(/\/+$/,"")+"/"+t.replace(/^\/+/,""):t}function i(e){return Object.keys(e).forEach((t=>{"content-type"===t.toLowerCase().trim()&&delete e[t]})),e}function n(e){let t="";for(let r in e){let s=e[r],o=Object.prototype.toString.call(s);"[object Array]"===o?s.forEach((e=>t+=`${r}=${e}&`)):t+="[object Object]"===o?`${r}=${JSON.stringify(s)}&`:`${r}=${s}&`}return t.replace(/&$/,"")}function l(e){const t={url:e,params:{}};if(!(e.indexOf("?")>=0))return t;const r=e.split("?");return t.url=r[0],r[1]?(r[1].split("&").map((e=>e.split("="))).forEach((e=>{if(2===e.length){const r=e[0],s=e[1];t.params.hasOwnProperty(r)?(t.params[r]=[t.params[r]],t.params[r].push(s)):t.params[r]=s}})),t):t}function c(e){let t=l(a(e.baseURL,e.url));const r=n(Object.assign({},t.params,e.params));return r?t.url+"?"+r:t.url}const p={errMsg:"request:fail cancel"};class f{config;static create(e={}){return new f(e)}constructor(e={}){this.config=e}request(t){return function(t){const r=new e.Completer;let s=!1;if(Array.isArray(t.interceptors))for(const e of t.interceptors)if(e.request&&!0===(t=e.request(t)).cancel){s=!0,e.fail&&e.fail(p),e.complete&&e.complete(p);break}if(s)return r.completeError(p),r.promise;const o=c(t),a=t.filePath||t.file||t.files&&t.files.length,n=e=>{t.interceptors?.filter((e=>e.success)).forEach((t=>e=t.success(e))),t.success?t.success(e):r.complete(e)},l=e=>{t.interceptors?.filter((e=>e.fail)).forEach((t=>e=t.fail(e))),t.fail?t.fail(e):r.completeError(e)},f=e=>{t.interceptors?.filter((e=>e.complete)).forEach((t=>e=t.complete(e))),t.complete&&t.complete(e)};if(a){t.header=i(t.header??{});const e=uni.uploadFile({url:o,files:t.files,fileType:t.fileType,file:t.file,filePath:t.filePath,name:t.name,header:t.header,formData:t.data,success:e=>{let t;try{t=JSON.parse(e.data)}catch(r){t=e.data}const r={statusCode:e.statusCode,header:{},cookies:[],data:t};n(r)},fail:l,complete:f});t.abortController?.completer.promise.then((()=>e.abort())),t.onProgressUpdate&&e.onProgressUpdate(t.onProgressUpdate),t.onHeadersReceived&&e.onHeadersReceived(t.onHeadersReceived),t.offProgressUpdate&&e.offProgressUpdate(t.offProgressUpdate),t.offHeadersReceived&&e.offHeadersReceived(t.offHeadersReceived)}else{const e=uni.request({url:o,data:t.data,header:t.header,method:t.method,timeout:t.timeout,dataType:t.dataType,responseType:t.responseType,sslVerify:t.sslVerify,withCredentials:t.withCredentials,firstIpv4:t.firstIpv4,success:n,fail:l,complete:f});t.abortController?.completer.promise.then((()=>e.abort())),t.offHeadersReceived&&e.offHeadersReceived(t.offHeadersReceived),t.onHeadersReceived&&e.onHeadersReceived(t.onHeadersReceived)}return r.promise}(o(t,this.config))}_request(e,t,r={}){return"string"==typeof t?r.url=t:r=t,r.method=e,this.request(r)}get(e,t){return this._request("GET",e,t)}post(e,t){return this._request("POST",e,t)}put(e,t){return this._request("PUT",e,t)}delete(e,t){return this._request("DELETE",e,t)}options(e,t){return this._request("OPTIONS",e,t)}head(e,t){return this._request("HEAD",e,t)}reace(e,t){return this._request("TRACE",e,t)}connect(e,t){return this._request("CONNECT",e,t)}}class d{}})(),s})()}));