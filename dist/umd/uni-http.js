!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.uniHttp=t():e.uniHttp=t()}(this,(function(){return(()=>{"use strict";var e={d:(t,r)=>{for(var s in r)e.o(r,s)&&!e.o(t,s)&&Object.defineProperty(t,s,{enumerable:!0,get:r[s]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t),r:e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}},t={};e.r(t),e.d(t,{UniAbortController:()=>s,UniHttp:()=>u,jsonToSerialize:()=>n,mergeConfig:()=>o,mergeUrl:()=>a,parseUrlParams:()=>c,removeHeaderContentType:()=>i,urlWithParams:()=>l});class r extends class{isCompleted=!1}{_res;_rej;promise;constructor(){super(),this.promise=new Promise(((e,t)=>{this._res=e,this._rej=t}))}complete(e){if(this.isCompleted)throw Error("Promise already completed");this._res(e),this.isCompleted=!0}completeError(e){if(this.isCompleted)throw Error("Promise already completed");this._rej(e),this.isCompleted=!0}}class s{completer;constructor(){this.completer=new r}abort(){this.completer.complete(!0)}}function o(e,t){const r={baseURL:e.baseURL??t.baseURL,url:e.url??t.url,method:e.method??t.method??"GET",data:Object.assign({},t.data,e.data),params:Object.assign({},t.params,e.params),header:Object.assign({},t.header,e.header),filePath:e.filePath??t.filePath,name:e.name??t.name,timeout:e.timeout??t.timeout,dataType:e.dataType??t.dataType,responseType:e.responseType??t.responseType,sslVerify:e.sslVerify??t.sslVerify,withCredentials:e.withCredentials??t.withCredentials,firstIpv4:e.firstIpv4??t.firstIpv4,success:e.success??t.success,fail:e.fail??t.fail,complete:e.complete??t.complete,fileType:e.fileType??t.fileType,file:e.file??t.file,files:e.files??[],abortController:e.abortController??t.abortController,offHeadersReceived:e.offHeadersReceived??t.offHeadersReceived,onHeadersReceived:e.onHeadersReceived??t.onHeadersReceived,onProgressUpdate:e.onProgressUpdate??t.onProgressUpdate,offProgressUpdate:e.offProgressUpdate??t.offProgressUpdate,interceptors:e.interceptors??[]};return t.files&&(r.files=r.files?.concat(t.files)),t.interceptors&&(r.interceptors=r.interceptors?.concat(t.interceptors)),r}function a(e,t=""){const r=t.match(/^https?:\/\//);return r||t.startsWith("/")||(t="/"+t),e?r?t:e.replace(/\/+$/,"")+"/"+t.replace(/^\/+/,""):t}function i(e){return Object.keys(e).forEach((t=>{"content-type"===t.toLowerCase().trim()&&delete e[t]})),e}function n(e){let t="";for(let r in e){let s=e[r],o=Object.prototype.toString.call(s);"[object Array]"===o?s.forEach((e=>t+=`${r}=${e}&`)):t+="[object Object]"===o?`${r}=${JSON.stringify(s)}&`:`${r}=${s}&`}return t.replace(/&$/,"")}function c(e){const t={url:e,params:{}};if(!(e.indexOf("?")>=0))return t;const r=e.split("?");return t.url=r[0],r[1]?(r[1].split("&").map((e=>e.split("="))).forEach((e=>{if(2===e.length){const r=e[0],s=e[1];t.params.hasOwnProperty(r)?(t.params[r]=[t.params[r]],t.params[r].push(s)):t.params[r]=s}})),t):t}function l(e){let t=c(a(e.baseURL,e.url));const r=n(Object.assign({},t.params,e.params));return r?t.url+"?"+r:t.url}const f={errMsg:"request:fail cancel"};function p(e,t){return{[Symbol.asyncIterator]:()=>({i:0,async next(){if(this.i<e.length){const r=e[this.i++];return await t(r),{value:r,done:!1}}return{value:null,done:!0}}})}}function d(e,t){return e?e.filter((e=>t in e&&"function"==typeof e[t])):[]}class u{config;static create(e={}){return new u(e)}constructor(e={}){this.config=e}request(e){return async function(e){const t=new r;let s=!1;for await(const t of p(d(e.interceptors,"request"),(t=>t.request?.(e))))if(t&&!0===e.cancel){s=!0,t.fail?.(f,e),t.complete?.(f,e);break}if(s)return t.completeError(f),t.promise;const o=l(e),a=e.filePath||e.file||e.files&&e.files.length,n=async r=>{for await(const t of p(d(e.interceptors,"success"),(async t=>r=await t.success(r,e))));e.success?e.success(r):t.complete(r)},c=async r=>{for await(const t of p(d(e.interceptors,"fail"),(async t=>t.fail?.(r,e))));e.fail?e.fail(r):t.completeError(r)},u=async t=>{for await(const r of p(d(e.interceptors,"complete"),(async r=>r.complete?.(t,e))));e.complete?.(t)};if(a){e.header=i(e.header??{});const t=uni.uploadFile({url:o,files:e.files,fileType:e.fileType,file:e.file,filePath:e.filePath,name:e.name,header:e.header,formData:e.data,success:e=>{let t;try{t=JSON.parse(e.data)}catch(r){t=e.data}const r={statusCode:e.statusCode,header:{},cookies:[],data:t};n(r)},fail:c,complete:u});e.abortController?.completer.promise.then((()=>t.abort())),e.onProgressUpdate&&t.onProgressUpdate(e.onProgressUpdate),e.onHeadersReceived&&t.onHeadersReceived(e.onHeadersReceived),e.offProgressUpdate&&t.offProgressUpdate(e.offProgressUpdate),e.offHeadersReceived&&t.offHeadersReceived(e.offHeadersReceived)}else{const t=uni.request({url:o,data:e.data,header:e.header,method:e.method,timeout:e.timeout,dataType:e.dataType,responseType:e.responseType,sslVerify:e.sslVerify,withCredentials:e.withCredentials,firstIpv4:e.firstIpv4,success:n,fail:c,complete:u});e.abortController?.completer.promise.then((()=>t.abort())),e.offHeadersReceived&&t.offHeadersReceived(e.offHeadersReceived),e.onHeadersReceived&&t.onHeadersReceived(e.onHeadersReceived)}return t.promise}(o(e,this.config))}_request(e,t,r={}){return"string"==typeof t?r.url=t:r=t,r.method=e,this.request(r)}get(e,t){return this._request("GET",e,t)}post(e,t){return this._request("POST",e,t)}put(e,t){return this._request("PUT",e,t)}delete(e,t){return this._request("DELETE",e,t)}options(e,t){return this._request("OPTIONS",e,t)}head(e,t){return this._request("HEAD",e,t)}reace(e,t){return this._request("TRACE",e,t)}connect(e,t){return this._request("CONNECT",e,t)}}return t})()}));